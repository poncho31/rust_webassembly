<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test d'Int√©gration - Serveur Rust/WebAssembly</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .test-section h2 {
            color: #495057;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8em;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.testing {
            background: #fff3cd;
            color: #856404;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            background: #f1f3f4;
            border-left: 4px solid #007bff;
        }
        .form-test {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .form-test input, .form-test select {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-test input:focus, .form-test select:focus {
            outline: none;
            border-color: #667eea;
        }
        .summary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
        }
        .icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test d'Int√©gration Complet</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            Validation de l'int√©gration PostgreSQL dans le serveur Rust/WebAssembly
        </p>

        <!-- Test 1: Ping Server -->
        <div class="test-section">
            <h2>
                <span class="icon">üèì</span>
                Test de Connectivit√© Serveur
                <span id="ping-status" class="status testing">EN ATTENTE</span>
            </h2>
            <p>V√©rification que le serveur r√©pond aux requ√™tes ping.</p>
            <button onclick="testPing()">Tester Ping</button>
            <div id="ping-result" class="result" style="display: none;"></div>
        </div>

        <!-- Test 2: Weather API -->
        <div class="test-section">
            <h2>
                <span class="icon">üå°Ô∏è</span>
                Test API M√©t√©o
                <span id="weather-status" class="status testing">EN ATTENTE</span>
            </h2>
            <p>V√©rification du bon fonctionnement de l'API m√©t√©o.</p>
            <button onclick="testWeather()">Tester M√©t√©o</button>
            <div id="weather-result" class="result" style="display: none;"></div>
        </div>

        <!-- Test 3: Form Submission -->
        <div class="test-section">
            <h2>
                <span class="icon">üìù</span>
                Test Soumission Formulaire
                <span id="form-status" class="status testing">EN ATTENTE</span>
            </h2>
            <p>Test de soumission de formulaire avec sauvegarde PostgreSQL (si disponible).</p>
            
            <div class="form-test">
                <input type="text" id="login" placeholder="Login" value="testuser">
                <input type="date" id="birthday" value="1990-01-01">
                <input type="text" id="firstname" placeholder="Pr√©nom" value="Test">
                <input type="text" id="lastname" placeholder="Nom" value="User">
                <select id="sexe">
                    <option value="M">Masculin</option>
                    <option value="F">F√©minin</option>
                    <option value="O">Autre</option>
                </select>
                <input type="number" id="age" placeholder="√Çge" value="30" min="0" max="120">
                <input type="text" id="info" placeholder="Informations" value="Test d'int√©gration">
                <input type="email" id="email" placeholder="Email" value="test@example.com">
            </div>
            
            <button onclick="testForm()">Soumettre Formulaire</button>
            <div id="form-result" class="result" style="display: none;"></div>
        </div>

        <!-- Test 4: Database Query -->
        <div class="test-section">
            <h2>
                <span class="icon">üóÑÔ∏è</span>
                Test R√©cup√©ration Donn√©es
                <span id="db-status" class="status testing">EN ATTENTE</span>
            </h2>
            <p>V√©rification de la r√©cup√©ration des donn√©es depuis PostgreSQL.</p>
            <button onclick="testDatabase()">R√©cup√©rer Donn√©es</button>
            <div id="db-result" class="result" style="display: none;"></div>
        </div>

        <!-- Test 5: SSL/TLS -->
        <div class="test-section">
            <h2>
                <span class="icon">üîí</span>
                Test Certificat SSL
                <span id="ssl-status" class="status testing">EN ATTENTE</span>
            </h2>
            <p>V√©rification du certificat SSL auto-sign√©.</p>
            <button onclick="testSSL()">V√©rifier SSL</button>
            <div id="ssl-result" class="result" style="display: none;"></div>
        </div>

        <!-- Summary -->
        <div class="summary">
            <h2>üìä R√©sum√© des Tests</h2>
            <div id="test-summary">
                <p>Cliquez sur les boutons ci-dessus pour ex√©cuter les tests.</p>
            </div>
        </div>
    </div>

    <script>
        let testResults = {
            ping: null,
            weather: null,
            form: null,
            database: null,
            ssl: null
        };

        function updateStatus(testName, status, message = '') {
            const statusElement = document.getElementById(`${testName}-status`);
            const resultElement = document.getElementById(`${testName}-result`);
            
            statusElement.className = `status ${status}`;
            statusElement.textContent = status === 'success' ? '‚úÖ SUCC√àS' : 
                                        status === 'error' ? '‚ùå √âCHEC' : 
                                        '‚è≥ EN COURS';
            
            if (message) {
                resultElement.style.display = 'block';
                resultElement.textContent = message;
            }
            
            testResults[testName] = status;
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('test-summary');
            const results = Object.values(testResults);
            const success = results.filter(r => r === 'success').length;
            const failed = results.filter(r => r === 'error').length;
            const total = results.filter(r => r !== null).length;
            
            if (total === 0) {
                summary.innerHTML = '<p>Cliquez sur les boutons ci-dessus pour ex√©cuter les tests.</p>';
                return;
            }
            
            summary.innerHTML = `
                <p><strong>Tests ex√©cut√©s:</strong> ${total}/5</p>
                <p><strong>Succ√®s:</strong> ${success} | <strong>√âchecs:</strong> ${failed}</p>
                <p><strong>Taux de r√©ussite:</strong> ${total > 0 ? Math.round((success/total)*100) : 0}%</p>
            `;
        }

        async function testPing() {
            updateStatus('ping', 'testing');
            try {
                const response = await fetch('/api/ping', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.text();
                    updateStatus('ping', 'success', `R√©ponse serveur: ${data}`);
                } else {
                    updateStatus('ping', 'error', `Erreur HTTP: ${response.status}`);
                }
            } catch (error) {
                updateStatus('ping', 'error', `Erreur: ${error.message}`);
            }
        }

        async function testWeather() {
            updateStatus('weather', 'testing');
            try {
                const response = await fetch('/api/weather/temperature?region=Bruxelles&pays=Belgique');
                
                if (response.ok) {
                    const data = await response.text();
                    updateStatus('weather', 'success', `Donn√©es m√©t√©o: ${data}`);
                } else {
                    updateStatus('weather', 'error', `Erreur HTTP: ${response.status}`);
                }
            } catch (error) {
                updateStatus('weather', 'error', `Erreur: ${error.message}`);
            }
        }

        async function testForm() {
            updateStatus('form', 'testing');
            try {
                const formData = {
                    login: document.getElementById('login').value,
                    birthday: document.getElementById('birthday').value,
                    firstname: document.getElementById('firstname').value,
                    lastname: document.getElementById('lastname').value,
                    sexe: document.getElementById('sexe').value,
                    age: parseInt(document.getElementById('age').value),
                    info: document.getElementById('info').value,
                    email: document.getElementById('email').value
                };

                const response = await fetch('/api/form', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    updateStatus('form', 'success', 
                        `Formulaire soumis avec succ√®s!\n` +
                        `ID: ${result.id || 'N/A'}\n` +
                        `Statut: ${result.status}\n` +
                        `Message: ${result.message}`
                    );
                } else {
                    const error = await response.text();
                    updateStatus('form', 'error', `Erreur: ${error}`);
                }
            } catch (error) {
                updateStatus('form', 'error', `Erreur: ${error.message}`);
            }
        }

        async function testDatabase() {
            updateStatus('database', 'testing');
            try {
                const response = await fetch('/api/form', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (Array.isArray(data)) {
                        updateStatus('database', 'success', 
                            `Donn√©es r√©cup√©r√©es: ${data.length} enregistrement(s)\n` +
                            `${data.length > 0 ? JSON.stringify(data[0], null, 2) : 'Aucune donn√©e'}`
                        );
                    } else {
                        updateStatus('database', 'success', 
                            `R√©ponse: ${JSON.stringify(data, null, 2)}`
                        );
                    }
                } else {
                    updateStatus('database', 'error', `Erreur HTTP: ${response.status}`);
                }
            } catch (error) {
                updateStatus('database', 'error', `Erreur: ${error.message}`);
            }
        }

        function testSSL() {
            updateStatus('ssl', 'testing');
            
            // V√©rifier si on est en HTTPS
            if (location.protocol === 'https:') {
                updateStatus('ssl', 'success', 
                    `‚úÖ Connexion HTTPS active\n` +
                    `Protocole: ${location.protocol}\n` +
                    `Host: ${location.host}\n` +
                    `Certificat: Auto-sign√© (d√©veloppement)`
                );
            } else {
                updateStatus('ssl', 'error', 
                    `‚ùå Connexion HTTP d√©tect√©e\n` +
                    `Protocole actuel: ${location.protocol}\n` +
                    `Veuillez acc√©der via HTTPS`
                );
            }
        }

        // Ex√©cuter un test automatique au chargement
        window.addEventListener('load', () => {
            console.log('üß™ Page de test d\'int√©gration charg√©e');
            testSSL(); // Test SSL automatique
        });
    </script>
</body>
</html>
